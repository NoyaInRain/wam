download: https://github.com/owncloud/core.git#stable9.1
mode: phpfpm
stack: php5
data_dirs:
    - config
static:
    /:
        path: .
        exclude: ^/data
hook: |
    if [ ! -f config/config.php ]; then
        # Handle (large) data directory manually, so it won't be included in regular backups
        mkdir -p data
        sudo chown www-data:www-data data
        # Disable appstore so installation works with unwritable apps directory
        sudo -u www-data sh -c "echo \"<?php \\\$CONFIG = array('appstoreenabled' => false); ?>\" > config/config.php"
        sudo -u www-data php occ maintenance:install --admin-user={wam.config[user]} --admin-pass={wam.config[password]}
        # Installation always sets trusted_domains to localhost
        sudo -u www-data sed -i "s/'localhost'/'{app.id}'/" config/config.php
    else
        sudo -u www-data php occ upgrade || true
    fi
extension_path: apps
default_extensions:
    # core
    - https://github.com/owncloud/activity.git#stable9.1
    - https://github.com/owncloud/files_antivirus.git#stable9.1
    - https://github.com/owncloud/files_texteditor.git#stable9.1
    - https://github.com/owncloud/files_pdfviewer.git#stable9.1
    - https://github.com/owncloud/files_videoplayer.git#stable9.1
    - https://github.com/owncloud/firstrunwizard.git#stable9.1
    - https://github.com/owncloud/gallery.git#stable9.1
    - https://github.com/owncloud/notifications.git#stable9.1
    - https://github.com/owncloud/templateeditor.git#stable9.1
    # https://github.com/owncloud/user_ldap has no suitable branches/tags
    # CalDAV + CardDAV
    - https://github.com/owncloud/calendar.git#v1.3.3
    - https://github.com/owncloud/contacts.git#v1.4.0.0
